import Content from "./content.js";
import Data from "./data.js";
import ItemList from "./item-list.js";

export default class ProjectList extends ItemList {
    #newProject = true;
    
    /**
     * 
     * @param {String} id 
     * @param {Data} data 
     * @param {Content} content 
     */
    constructor (id, data, content) {
        super(id);

        this.data = data;
        this.content = content;
        document.addEventListener("keydown", (e) => {
            if (this.#newProject && e.key === "Escape")
                this.render();
        });
    }

    /**
     * @returns {Data} data object
     */
    get data () { return this._data; }

    /**
     * @param {Data} obj
     */
    set data (obj) { this._data = obj; }

    /**
     * @returns {Content} content object
     */
    get content () { return this._content; }

    /**
     * @param {Content} obj
     */
    set content (obj) { this._content = obj; }

    /**
     * 
     * @param {boolean} add 
     */
    render (add=false) {
        this.#newProject = add;
        this.list.innerHTML = "";

        // Iterate through Projects and build List
        this.data.projects.forEach(p => {
            // Create Project Item for List
            const item = document.createElement("div");
            item.classList.add("project-item");
            item.addEventListener("click", (e) => { this.content.title = p.name; });

            // Add Colour Tag for Project Item
            const tag = document.createElement("div");
            tag.textContent = "#";
            tag.classList.add("tag-colour");
            tag.setAttribute("style", `color: ${p.colour}`);

            // Add Name for Project Item
            const name = document.createElement("div");
            name.textContent = p.name;

            // Add Delete Button for Project Item
            const del = document.createElement("div");
            del.classList.add("tag-delete");
            del.textContent = "x";
            del.addEventListener("click", (e) => {
                data.deleteProject(p.name);
                if (this.content.title === p.name)
                    this.content.title = "To-Dos";
                e.stopPropagation();
                this.render();
            });

            // Append Elements to Project Item
            item.appendChild(tag);
            item.appendChild(name);
            item.append(del);

            // Append Item to List
            this.list.append(item);
        });

        // Create Element for Adding a New Project
        if (add) {
            // Create New-Project Item
            const newProject = document.createElement("div");
            newProject.classList.add("new-project");

            // Add Colour Input for New-Project Item
            const colour = document.createElement("input");
            colour.type = "color";
            colour.value = `#${(Math.random() * 0xffffff * 1000000).toString(16).slice(0, 6)}`;
            colour.classList.add("new-project-colour");

            // Add Name Input for New-Project Item
            const name = document.createElement("input");
            name.type = "text";
            name.defaultValue = "New Project";
            name.classList.add("new-project-name");

            // Add Confirm Button for New-Project Item
            const confirm = document.createElement("button");
            confirm.textContent = "Confirm";
            confirm.classList.add("new-project-confirm");
            confirm.addEventListener("click", (e) => {
                if (name.value === "" || name.value === "New Project")
                    window.alert("Please add a name for your new project.");
                else {
                    this.data.addProject(name.value, colour.value);
                    this.render();
                }
            });

            // Add Cancel Button for New-Project Item
            const cancel = document.createElement("button");
            cancel.textContent = "Cancel";
            cancel.classList.add("new-project-cancel");
            cancel.addEventListener("click", (e) => { this.render(); });

            // Append Elements to New-Project Item
            newProject.appendChild(colour);
            newProject.appendChild(name);
            newProject.appendChild(confirm);
            newProject.appendChild(cancel);

            // Append New-Project Item to List
            this.list.appendChild(newProject);

            name.focus();
            name.select();
        }
    }
}